{% extends "sprout-redirects/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set title = (redirect.id != "" ? "Edit Redirect"|t('sprout-redirects') : "Create a new redirect"|t('sprout-redirects')) %}

{% set crumbs = [
    { label: "Redirects"|t('sprout-redirects'), url: url('sprout-redirects/redirects/' ~ currentSite.handle) }
] %}

{% set fullPageForm = true %}
{% set saveShortcutRedirect = continueEditingUrl %}

{% set selectedItem = currentSite %}

{% block actionButton %}
    <div class="btngroup submit first">
        <input type="submit" class="btn submit" value="{{ 'Save'|t('sprout-redirects') }}">
        <div class="btn submit menubtn"></div>
        <div class="menu">
            <ul>
                <li><a class="formsubmit"
                       data-redirect="{{ continueEditingUrl|hash }}">{{ "Save and continue editing"|t('sprout-redirects') }}
                        <span class="shortcut">âŒ˜S</span></a></li>
                <li><a class="formsubmit"
                       data-redirect="{{ saveAsNewUrl|hash }}">{{ "Save and add another"|t('sprout-redirects') }}</a>
                </li>
                {% if redirect.id is not null %}
                    <hr>
                    <ul>
                        <li><a class="formsubmit error" data-action="sprout-redirects/redirects/delete-redirect" data-confirm="{{ 'Are you sure you want to delete this redirect?'|t('sprout-redirects') }}" data-redirect="{{ cpUrl('sprout-redirects/redirects/' ~ currentSite.handle)|hash }}">{{ "Delete"|t('sprout-redirects') }}</a></li>
                    </ul>
                {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}

{% block content %}

    <input type="hidden" name="action"
           value="sprout-redirects/redirects/save-redirect">
    <input type="hidden" name="redirectId" value="{{ redirect.id }}">
    <input type="hidden" name="redirect"
           value="{{ 'sprout-redirects/redirects'|hash }}">

    {% if redirect.id %}
        <input type="hidden" name="redirectId"
               value="{{ redirect.id }}">
    {% endif %}

    <input type="hidden" name="siteId"
           value="{{ currentSite.id }}">

    {% include "sprout-redirects/redirects/_fields" %}

{% endblock %}

{% block details %}

    <div class="meta">
        {{ forms.lightswitchField({
            label: "Enabled"|t('sprout-redirects'),
            name: 'enabled',
            on: redirect.enabled,
            id: 'enabled',
            first: true
        }) }}
    </div>

    <hr>

    <div class="meta read-only">
        <div class="data">
            <div class="heading">{{ "Site"|t('sprout-redirects') }}</div>
            <div class="value">{{ redirect.getSite().name }}</div>
        </div>
        <div class="data">
            <div class="heading">{{ "Base URL"|t('sprout-redirects') }}</div>
            <div class="value">{{ redirect.getSite().baseUrl }}</div>
        </div>
        {% if redirect.id %}
            <div class="data">
                <div class="heading">{{ "Count <span class='info'>The total number of times a redirect has been used.</span>"|t('sprout-redirects')|raw }}</div>
                <div class="value">{{ redirect.count }}</div>
            </div>
        {% endif %}
    </div>

    <hr>

    <div class="meta">

        <h2>{{ "Regular Expressions"|t('sprout-redirects') }}</h2>

        <p>{{ "Redirect multiple URLs with a similar pattern by selecting the 'Evaluate regular expressions' option."|t('sprout-redirects') }}</p>

        <p><strong>{{ "Old URL - Regular Expressions"|t('sprout-redirects') }}</strong></p>
        <ul>
            <li>{{ "old-location/(.*)"|t('sprout-redirects') }}</li>
            <li>{{ "old-location/(\\d{4})/(\\d{2})"|t('sprout-redirects') }}</li>
        </ul>

        <p><strong>{{ "New URL - Capture Groups"|t('sprout-redirects') }}</strong></p>
        <ul>
            <li><em>{{ "new-location/$1"|t('sprout-redirects') }}</em></li>
            <li><em>{{ "new-location/$1/$2"|t('sprout-redirects') }}</em></li>
        </ul>

    </div>
{% endblock %}
